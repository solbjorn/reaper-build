--[[-----------------------------------------------------------------------------------------------
 File         : sa_callbacks.script
 Description  : Библиотека колбеков
 Copyright    : Shadows Addon
 Author       : Ray Twitty aka Shadows
 Date         : 06.11.2012
 Last edit    : 12.11.2018
--]]-----------------------------------------------------------------------------------------------
prefetch("sa_utils")
--[[-----------------------------------------------------------------------------------------------
 * ACTOR
--]]-----------------------------------------------------------------------------------------------
function actor_update(delta)
	sa_hud_interface_mgr.get_hud_interface_mgr():update()
	sa_inventory_items_mgr.repack_ammo()
	sa_main.bunker_cooling_sound()
	reap.update()
end
---------------------------------------------------------------------------------------------------
function actor_net_spawn()
	reap.net_spawn()
end
---------------------------------------------------------------------------------------------------
local last_mob_type
local last_health
---------------------------------------------------------------------------------------------------
function actor_hit(obj, amount, local_direction, who, bone_index)
	if last_mob_type then
		reap.hit_effectors(last_mob_type, who, last_health - db_actor.health)
	end
	last_mob_type = nil
end
---------------------------------------------------------------------------------------------------
function item_take(obj)
	if device().precache_frame == 0 then
		sa_inventory_items_mgr.artefacts_statistic(obj)
	end
end
---------------------------------------------------------------------------------------------------
local belt_obj_by_id = {}
---------------------------------------------------------------------------------------------------
function item_drop(obj)
	if belt_obj_by_id[obj:id()] then
		item_drop_from_belt(obj)
	end
	belt_obj_by_id[obj:id()] = nil
end
---------------------------------------------------------------------------------------------------
function item_drop_from_inventory(obj)
end
---------------------------------------------------------------------------------------------------
function item_drop_from_belt(obj)
	sa_inventory_items_mgr.update_artefacts_belt_lock(obj)
end
---------------------------------------------------------------------------------------------------
function item_belt(obj)
	sa_inventory_items_mgr.update_artefacts_belt_lock(obj)
	if db_actor:belt_count() > 1 then
		sa_inventory_items_mgr.check_ammo(obj)
	end
	reap.item_belt(obj)
	belt_obj_by_id[obj:id()] = obj
end
---------------------------------------------------------------------------------------------------
function item_ruck(obj)
	sa_inventory_items_mgr.update_artefacts_belt_lock(obj)
	if db_actor:ruck_count() > 1 then
		sa_inventory_items_mgr.check_ammo(obj)
	end
	reap.item_ruck(obj)
	belt_obj_by_id[obj:id()] = nil
end
---------------------------------------------------------------------------------------------------
function item_slot(obj)
	reap.item_slot(obj)
	belt_obj_by_id[obj:id()] = nil
end
---------------------------------------------------------------------------------------------------
function hit_effector(mob_type, side)
	if not last_mob_type or mob_type ~= hit_mob_types.generic then
		last_mob_type = mob_type
		last_health = db_actor.health
	end
end
---------------------------------------------------------------------------------------------------
function actor_save(packet)
	reap.save(packet)
end
---------------------------------------------------------------------------------------------------
function actor_load(reader)
	reap.load(reader)
end
--[[-----------------------------------------------------------------------------------------------
 * MONSTER
--]]-----------------------------------------------------------------------------------------------
function monster_update(obj)
	if obj:alive() and db_actor:alive() then
		local enemy = obj:get_enemy()
		if enemy and obj:see(enemy) and enemy:id() == db_actor_id then
			sa_monsters.pseudodog_psy_effect(obj)
			sa_monsters.burer_tele_attack(obj)
		end
		sa_monsters.controller_death_zone(obj)
	end
end
